package audio

// Constants describing the raw waveform data.
const (
	lookupCount  = 32     // how many points in each loop sample
	waveCount    = 8      // how many distinct waveforms
	maxWaveValue = 0xf    // the max value in a wave
	encodedRange = 0xffff // full swing wanted in the encoded output
)

// A waveBytes is a single waveform
type waveBytes [lookupCount]byte

var (
	// |
	// |              .:::::.
	// |          .:::::::::::::.
	// |        .:::::::::::::::::.
	// |      .:::::::::::::::::::::.
	// |    .:::::::::::::::::::::::::.
	// |   :::::::::::::::::::::::::::::
	// |  :::::::::::::::::::::::::::::::
	// | -'''''''''''''''''''''''''''''''-...............................
	// |                                   :::::::::::::::::::::::::::::
	// |                                    ':::::::::::::::::::::::::'
	// |                                      ':::::::::::::::::::::'
	// |                                        ':::::::::::::::::'
	// |                                          ':::::::::::::'
	// |                                              ':::::'
	// |
	waveData0 = waveBytes{
		0x7, 0x9, 0xa, 0xb, 0xc, 0xd, 0xd, 0xe, 0xe, 0xe, 0xd, 0xd, 0xc, 0xb, 0xa, 0x9,
		0x7, 0x5, 0x4, 0x3, 0x2, 0x1, 0x1, 0x0, 0x0, 0x0, 0x1, 0x1, 0x2, 0x3, 0x4, 0x5,
	}

	// |
	// |     :::.
	// |    ::::::
	// |   ::::::::
	// |   :::::::::    .:::.                :.
	// |  .:::::::::: .:::::::.             ::::
	// |  ::::::::::::::::::::::           ::::::
	// |  ::::::::::::::::::::::          ::::::::
	// | -''''''''''''''''''''''-........-'''''''''......................
	// |                          ::::::           ::::::::::::::::::::::
	// |                           ::::             ':::::::' ::::::::::'
	// |                            ':                ':::'    :::::::::
	// |                                                        ::::::::
	// |                                                         ::::::
	// |                                                          ':::
	// |
	waveData1 = waveBytes{
		0x7, 0xc, 0xe, 0xe, 0xd, 0xb, 0x9, 0xa, 0xb, 0xb, 0xa, 0x9, 0x6, 0x4, 0x3, 0x5,
		0x7, 0x9, 0xb, 0xa, 0x8, 0x5, 0x4, 0x3, 0x3, 0x4, 0x5, 0x3, 0x1, 0x0, 0x0, 0x2,
	}

	// |
	// |        .:.                           .:.                  :
	// |      .:::::.                        :::::                 :
	// |     :::::::::                      :::::::                :
	// |    :::::::::::                    :::::::::              .:.
	// |   :::::::::::::                   :::::::::              :::
	// |  .:::::::::::::.                 :::::::::::             :::
	// |  :::::::::::::::                 :::::::::::             :::
	// | -'''''''''''''''-...............-'''''''''''-...........-'''-...
	// |                  ':::::::::::::'             :::::::::::     :::
	// |                   :::::::::::::               :::::::::      :::
	// |                    :::::::::::                :::::::::      ':'
	// |                     :::::::::                  :::::::        :
	// |                      ':::::'                    :::::         :
	// |                        ':'                       ':'          :
	// |
	waveData2 = waveBytes{
		0x7, 0xa, 0xc, 0xd, 0xe, 0xd, 0xc, 0xa, 0x7, 0x4, 0x2, 0x1, 0x0, 0x1, 0x2, 0x4,
		0x7, 0xb, 0xd, 0xe, 0xd, 0xb, 0x7, 0x3, 0x1, 0x0, 0x1, 0x3, 0x7, 0xe, 0x7, 0x0,
	}

	// |
	// |                   :
	// |   :       :      .::
	// |   ::     ::      ::::             :
	// |   :::   ::::    :::::             :
	// |  ::::. .::::    :::::.   .:      .::
	// |  ::::: ::::::  .::::::  :::      :::
	// |  ::::::::::::  ::::::: :::::     ::::             :
	// | -''''''''''''-.'''''''-'''''....-''''.....-.......''............
	// |                              :::      :::  ::::::'  :::::: :::::
	// |                              ::'      :'   ':::::    ::::' '::::
	// |                               :             :::::    ::::   :::
	// |                               :             ::::      ::     ::
	// |                                              ::'      :       :
	// |                                               :
	// |
	waveData3 = waveBytes{
		0x7, 0xd, 0xb, 0x8, 0xb, 0xd, 0x9, 0x6, 0xb, 0xe, 0xc, 0x7, 0x9, 0xa, 0x6, 0x2,
		0x7, 0xc, 0x8, 0x4, 0x5, 0x7, 0x2, 0x0, 0x3, 0x8, 0x5, 0x1, 0x3, 0x6, 0x3, 0x1,
	}

	// |     :
	// |     :       :
	// |     :       :       :
	// |    .:       :       :       :
	// |    :::     ::.     .:       :       :
	// |    :::     :::     :::     ::.     .:       :
	// |    :::     :::     :::     :::     :::     ::.     .:
	// |   ::::    ::::    ::::    ::::    ::::    ::::    ::::    :::
	// | ..''''-...''''-...''''-...''''-...''''-..'''''-'.-''''----'''--.
	// | ::     :::     :::     ::'     ':       :                      :
	// | ::     ::'     ':       :       :                              :
	// | :       :       :       :                                      '
	// | :       :       :
	// | :       :
	// | :
	// |
	waveData4 = waveBytes{
		0x0, 0x8, 0xf, 0x7, 0x1, 0x8, 0xe, 0x7, 0x2, 0x8, 0xd, 0x7, 0x3, 0x8, 0xc, 0x7,
		0x4, 0x8, 0xb, 0x7, 0x5, 0x8, 0xa, 0x7, 0x6, 0x8, 0x9, 0x7, 0x7, 0x8, 0x8, 0x7,
	}

	// |                               :   :
	// |                           :   :   :   :
	// |                       :   :   :   :   :   :
	// |                   :   :   :   :   :   :   :   :
	// |               :   :   :   :   :   :   :   :   :   :
	// |           :   :   :   :   :   :   :   :   :   :   :   :
	// |       :   :   :   :   :   :   :   :   :   :   :   :   :   :
	// |   :   :   :   :   :   :   :   :   ::  ::  ::  ::  ::  ::  ::  :
	// | --'-.-'-.-'-.-'-.-'-.-'-.-'-.-'-.-''.-''.-''.-''.-''.-''.-''--'-
	// |         :   :   :   :   :   :   :   :   :   :   :   :
	// |             :   :   :   :   :   :   :   :   :   :
	// |                 :   :   :   :   :   :   :   :
	// |                     :   :   :   :   :   :
	// |                         :   :   :   :
	// |                             :   :
	// |
	waveData5 = waveBytes{
		0x7, 0x8, 0x6, 0x9, 0x5, 0xa, 0x4, 0xb, 0x3, 0xc, 0x2, 0xd, 0x1, 0xe, 0x0, 0xf,
		0x0, 0xf, 0x1, 0xe, 0x2, 0xd, 0x3, 0xc, 0x4, 0xb, 0x5, 0xa, 0x6, 0x9, 0x7, 0x8,
	}

	// |                              .:::.
	// |                            .:::::::.
	// |                          .:::::::::::.
	// |                        .:::::::::::::::.
	// |                      .:::::::::::::::::::.
	// |                    .:::::::::::::::::::::::.
	// |                  .:::::::::::::::::::::::::::.
	// |                 :::::::::::::::::::::::::::::::
	// | .............'--'''''''''''''''''''''''''''''''--'..............
	// | :::::::::::'                                       '::::::::::::
	// | :::::::::'                                           '::::::::::
	// | :::::::'                                               '::::::::
	// | :::::'                                                   '::::::
	// | :::'                                                       '::::
	// | :'                                                           '::
	// |
	waveData6 = waveBytes{
		0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf,
		0xf, 0xe, 0xd, 0xc, 0xb, 0xa, 0x9, 0x8, 0x7, 0x6, 0x5, 0x4, 0x3, 0x2, 0x1, 0x0,
	}

	// |                              .:                              .:
	// |                            .:::                            .:::
	// |                          .:::::                          .:::::
	// |                        .:::::::                        .:::::::
	// |                      .:::::::::                      .:::::::::
	// |                    .:::::::::::                    .:::::::::::
	// |                  .:::::::::::::                  .:::::::::::::
	// |                 :::::::::::::::                 :::::::::::::::
	// | .............'--'''''''''''''''-.............'--'''''''''''''''-
	// | :::::::::::'                    :::::::::::'
	// | :::::::::'                      :::::::::'
	// | :::::::'                        :::::::'
	// | :::::'                          :::::'
	// | :::'                            :::'
	// | :'                              :'
	// |
	waveData7 = waveBytes{
		0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf,
		0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf,
	}
)

// waveData collects all the waveforms
var waveData = [waveCount]waveBytes{
	waveData0,
	waveData1,
	waveData2,
	waveData3,
	waveData4,
	waveData5,
	waveData6,
	waveData7,
}

// scaledWaveData contains waveData prescaled to each possible
// volume for the simulated hardware as a proportion of the
// maximum value in the ebiten output stream.

// Given that the output of several channels may be mixed
// together, the pre-mixed values are scaled down by the total
// number of values, so that the output cannot become saturated
// or overflow.
var scaledWaveData [volumeCount][waveCount][lookupCount]uint16

// init initalise the pre-scaled data at program start
func init() {
	for volume := range 16 {
		for wave := range waveData {
			for index, value := range waveData[wave] {
				scaled := uint32(value) * uint32(volume) * uint32(encodedRange) / (maxWaveValue * maxVolume * voiceCount)
				scaledWaveData[volume][wave][index] = uint16(scaled)
			}
		}
	}
}
